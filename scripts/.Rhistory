)
new_data$predicted_flux <- predict(mod_poly, newdata = new_data, re.form = NA)
# POLYNOMIAL
mod_poly <- lmer(mean_mound_fluxCH4 ~ poly(temp, 2) + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod_poly)
residuals <- resid(mod_poly)
fitted_values <- fitted(mod_poly)
new_data$predicted_flux <- predict(mod_poly, newdata = new_data, re.form = NA)
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line(aes(linetype = campaign)) +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
theme_minimal() +
theme(legend.position = "bottom")
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line(aes()) +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
theme_minimal() +
ggtitle("b)") +
theme(legend.position = "bottom")
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line() +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)") +
theme(legend.position = "bottom")
a
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line() +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)")
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line() +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)") +
theme_classic()
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line(se = TRUE) +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)") +
theme_classic()
ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line() +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)") +
theme_classic()
b <- ggplot(new_data, aes(x = temp, y = predicted_flux, color = campaign)) +
geom_line() +  # Different linetypes for campaigns
#facet_wrap(~ species_s) +              # Separate plots for each species
labs(
x = "Temperature (°C)",
y = "Predicted CH4 Flux (umol/d/m2)",
title = "Polynomial Relationship between Temperature and CH4 Flux"
) +
scale_color_brewer(palette = "Dark2")+
ggtitle("b)") +
theme_classic()
ggarrange(a, b)
ggarrange(a, b, ncol = 1)
mod <-  lmer(flux.CH4 ~ wall_thickness_mm + (1 | species_s) + (1 | sample), data = wt)
summary(mod)
Anova(mod)
# look at relationship just for coptotermes
mod <-  lmer(flux.CH4 ~ wall_thickness_mm + (1 | sample), data = wt[wt$species_s == "C. acinaciformis",])
Anova(mod)
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
mod <- lmer(mound_CH4flux ~ volume_m3_final + (1 | species_s) + (1 | sample), data = all_fluxes_mound_avg)
summary(mod)
Anova(mod)
# test differences between species
mod <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
summary(mod)
Anova(mod)
# test differences between species
mod1 <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
anova(mod, mod1)
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
mod <- lmer(mound_CH4flux ~ volume_m3_final + (1 | species_s) + (1 | sample), data = all_fluxes_mound_avg)
# test differences between species
mod1 <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
anova(mod, mod1)
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
mod <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
summary(mod)
Anova(mod)
Anova(mod)
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
mod <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
Anova(mod)
Anova(mod, type = "III")
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
mod <- lmer(mound_CH4flux ~ volume_m3_final*species_s + (1 | sample), data = all_fluxes_mound_avg)
Anova(mod)
Anova(mod, type = "III")
mod <-  lmer(flux.CH4 ~ wall_thickness_mm*species_s + (1 | sample), data = wt)
Anova(mod)
Anova(mod, type = 3))
Anova(mod, type = "III"))
Anova(mod, type = "III")
Anova(mod)
mod <-  lmer(flux.CH4 ~ wall_thickness_mm + (1 | species_s) + (1 | sample), data = wt)
Anova(mod)
# Q1: How does CH4 flux change by season?
mod <- lmer(mean_mound_fluxCH4 ~ campaign + (1 | species_s) + (1 | sample), data = all_fluxes_seasonal_avg)
summary(mod)
Anova(mod)
emm <- emmeans(mod, ~ campaign)
pairs(emm)
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp * campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
summary(mod)
emmeans(mod, pairwise ~ campaign)
# POLYNOMIAL
mod_poly <- lmer(mean_mound_fluxCH4 ~ poly(temp, 2) + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod_poly)
summary(mod_poly)
emmeans(mod, pairwise ~ campaign)
emmeans(mod_poly, pairwise ~ campaign)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(plyr)
library(ggpubr)
library(plotly)
library(tidyr)
library(easystats)
library(ggeffects)
library(emmeans)
library(lme4)
library(lmerTest)
library(splines)
# all_fluxes_NT <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_fluxes_NT.csv")
p_fluxes_f <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/p_fluxes_f.csv")
all_fluxes_mound_avg <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_fluxes_mound_avg.csv")
all_fluxes_mound <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_fluxes_mound.csv")
all_fluxes_seasonal_avg <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_fluxes_resample_reps_avg.csv")
# supplement (?)
all_fluxes_daily <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_daily_fluxes.csv")
# Q1: How does TEF vary across study species (fluxes from individuals)
a <- ggplot(p_fluxes_f, aes(x = species, y = TEF_ug_g_h, fill = species))+
geom_boxplot(outlier.shape = NA)+
geom_jitter()+
ylab("Termite EF (ug CH4/hr/g termite)")+
xlab("")+
scale_x_discrete(labels = c("A. laurensis", "C. acinaciformis", "N. magnus"))+
scale_fill_brewer(palette = "Dark2")+
theme_classic()+
ggtitle("a)") +
theme(legend.position = "none")
# Q2: How do mound fluxes vary across study species (mean fluxes from the mound)
b <- ggplot(all_fluxes_mound_avg, aes(x = species_s, y = mean_mound_fluxCH4*0.6683, fill = species_s)) + #  multiuple µmol CH₄/day by 0.6683
geom_boxplot()+
geom_jitter()+
scale_x_discrete(labels = c("A. laurensis", "C. acinaciformis", "N. magnus"))+
theme_classic()+
ylab("Mean mound CH4 flux (ug CH4/hr/m2)")+
xlab("")+
ggtitle("b)") +
scale_fill_brewer(palette = "Dark2")+
theme(legend.position = "none")
# Q3: What are the fluxes associated with termites in the mound vs. termites outside mound
# select columns from p_fluxes_f
NT_ch4_long <- p_fluxes_f %>% select(species, flux.CH4_A, flux.CH4_T, flux.CH4_M)
NT_ch4_long <- gather(NT_ch4_long, key = "source", value = "flux", -species)
NT_ch4_long$source <- factor(NT_ch4_long$source, levels = c("flux.CH4_A", "flux.CH4_T", "flux.CH4_M"))
NT_co2_long <- p_fluxes_f %>% select(species, flux.CO2_A, flux.CO2_T, flux.CO2_M)
NT_co2_long <- gather(NT_co2_long, key = "source", value = "flux", -species)
NT_co2_long$source <- factor(NT_co2_long$source, levels = c("flux.CO2_A", "flux.CO2_T", "flux.CO2_M"))
c <- ggplot(NT_ch4_long, aes(x = species, y = flux, fill = source))+
geom_boxplot(outlier.shape = NA)+
ylab("CH4 flux (umol/d/m2)")+
xlab("")+
scale_x_discrete(labels = c("A. laurensis", "C. acinaciformis", "N. magnus"))+
scale_fill_brewer(palette = "RdYlGn", labels = c("T+M", "T", "M"))+
ggtitle("c)") +
theme_classic()
d <- ggplot(NT_co2_long, aes(x = species, y = flux, fill = source))+
geom_boxplot(outlier.shape = NA)+
ylab("CO2 flux (mmol/d/m2)")+
xlab("")+
scale_x_discrete(labels = c("A. laurensis", "C. acinaciformis", "N. magnus"))+
scale_fill_brewer(palette = "RdYlGn", labels = c("T+M", "T", "M"))+
ggtitle("d)") +
theme_classic()
ggarrange(a, b, c, d)
View(p_fluxes_f)
# flux and wall thickness
a <- ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point()+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
# Q2: What is the relationship between mound size and CH4 flux?
# whole mound methane flux mound size (basal_area_m2, sa_m2_final, volume_m3_final)
b <- ggplot(all_fluxes_mound_avg, aes(x = volume_m3_final, y = mound_CH4flux, color = species_s)) +
geom_point()+
geom_smooth(data = subset(all_fluxes_mound_avg, species_s == "A. laurensis"), method = "lm", se = FALSE) +
geom_smooth(data = subset(all_fluxes_mound_avg, species_s == "N. magnus"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
scale_color_brewer(palette = "Dark2")+
theme_classic()+
ylab("Total mound CH4 flux (umol/d/mound)") +
xlab("Mound volume (m3)")+
ggtitle("b)") +
theme(legend.position = "none")
ggarrange(a, b, ncol = 1)
# flux and wall thickness
a <- ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point()+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
# Q1: What is the relationship between mound wall thickness and CH4 flux?
wt <- all_fluxes_mound[!is.na(all_fluxes_mound$wall_thickness_mm), ]
wt$sample <- as.factor(wt$sample)
# flux and wall thickness
a <- ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point()+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggarrange(a, b, ncol = 1)
ggplot(all_fluxes_seasonal_avg, aes(x = campaign, y = mean_mound_fluxCH4, fill = campaign))+
geom_boxplot()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
scale_x_discrete(labels = c("Wet-to-dry", "Mid-dry", "Dry-to-wet", "Mid-wet"))+
theme_classic()+
theme(legend.position = "none")
ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point()+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
#facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point( size = 10)+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point( size = 6)+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point( size = 4)+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggplot(wt, aes(x = wall_thickness_mm, y = flux.CH4, color = species_s)) +
geom_point( size = 4)+
geom_smooth(data = subset(wt, species_s == "C. acinaciformis"), method = "lm", se = FALSE) +
#facet_wrap(~species_s, scales = "free")+
theme_classic()+
ylab("CH4 flux umol/d/m2")+
xlab("Mound wall thickness (mm)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme(legend.position = "bottom")
ggplot(all_fluxes_mound_avg, aes(x = volume_m3_final, y = mound_CH4flux, color = species_s)) +
geom_point(size = 4)+
geom_smooth(data = subset(all_fluxes_mound_avg, species_s == "A. laurensis"), method = "lm", se = FALSE) +
geom_smooth(data = subset(all_fluxes_mound_avg, species_s == "N. magnus"), method = "lm", se = FALSE) +
# facet_wrap(~species_s, scales = "free")+
scale_color_brewer(palette = "Dark2")+
theme_classic()+
ylab("Total mound CH4 flux (umol/d/mound)") +
xlab("Mound volume (m3)")+
ggtitle("b)") +
theme(legend.position = "none")
ggplot(all_fluxes_seasonal_avg, aes(x = temp, y = mean_mound_fluxCH4, color = campaign))+
geom_point()+
geom_smooth(method = 'lm', se = TRUE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme_classic()
# Q2: How does CH4 flux change by temperature?
# LINEAR
a <- ggplot(all_fluxes_seasonal_avg, aes(x = temp, y = mean_mound_fluxCH4))+
geom_point()+
geom_smooth(method = 'lm', se = TRUE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme_classic()
a
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp + campaign + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
library(car)
Anova(mod)
# Q2: How does CH4 flux change by temperature?
# LINEAR
mod <- lmer(mean_mound_fluxCH4 ~ temp + (1 | sample) + (1 | species_s), data = all_fluxes_seasonal_avg)
Anova(mod)
summary(mod)
ggplot(all_fluxes_seasonal_avg, aes(x = temp, y = mean_mound_fluxCH4, color = campaign))+
geom_point()+
geom_smooth(method = 'lm', se = TRUE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme_classic()
ggplot(all_fluxes_seasonal_avg, aes(x = temp, y = mean_mound_fluxCH4, color = campaign))+
geom_point(size = 4)+
geom_smooth(method = 'lm', se = TRUE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme_classic()
ggplot(all_fluxes_seasonal_avg, aes(x = temp, y = mean_mound_fluxCH4, color = campaign))+
geom_point(size = 4)+
geom_smooth(method = 'lm', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer(palette = "Dark2")+
ggtitle("a)") +
theme_classic()
ggplot(all_fluxes_seasonal_avg, aes(x = campaign, y = mean_mound_fluxCH4, fill = species_s))+
geom_boxplot()
ggplot(all_fluxes_seasonal_avg, aes(x = campaign, y = mean_mound_fluxCH4, fill = campaign))+
geom_boxplot()
# Q1: How does CH4 flux change by season?
all_fluxes_seasonal_avg$campaign <- factor(all_fluxes_seasonal_avg$campaign, levels = c("may22", "aug23", "nov22", "feb24"))
all_fluxes_seasonal_avg$species_s <- as.factor(all_fluxes_seasonal_avg$species_s)
ggplot(all_fluxes_seasonal_avg, aes(x = campaign, y = mean_mound_fluxCH4, fill = campaign))+
geom_boxplot()
ggplot(all_fluxes_seasonal_avg, aes(x = campaign, y = mean_mound_fluxCH4, fill = campaign))+
geom_boxplot()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
scale_x_discrete(labels = c("Wet-to-dry", "Mid-dry", "Dry-to-wet", "Mid-wet"))+
theme_classic()+
theme(legend.position = "none")
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
metadata <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/data_out/metagenomes_metadata.csv")
top_e <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/data_out/q1_top_emitters.csv")
var_e <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/data_out/q2_variable_emitters.csv")
fluxes <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/all_fluxes_mound.csv")
targets <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/metagenomes/targets.csv")
ko <- read.delim("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/metagenomes/ko.table(ReadsPerSample).txt", header = TRUE, sep = "\t")
pathway <- read.delim("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/metagenomes/pathway.table(ReadsPerSample).txt", header = TRUE, sep = "\t")
cazymes <- read.delim("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/metagenomes/CAZy.single.table(ReadsPerSample).txt", header = TRUE, sep = "\t")
fluxes <- fluxes[fluxes$campaign == "may22", ]
fluxes$extract_ID <- paste(fluxes$sample,"-",fluxes$tag, "-", fluxes$position, sep = "")
x <- fluxes[, c("extract_ID", "flux.CH4")]
# merge x and metadata
metadata <- merge(x, metadata, by = "extract_ID")
# filter ko table for what is in the target list
ko_targets <- targets[targets$source == "ko", ]$target
# filter ko_table by Annotation = ko_targets
ko_table_targets <- ko[ko$Annotation %in% ko_targets, ]
# remove first column
ko_table_targets <- ko_table_targets[, -1]
# ko_table_targets to long format
ko_table_targets_l <- ko_table_targets %>%
pivot_longer(cols = -Annotation, names_to = "sequencing_id", values_to = "reads") %>%
mutate(sample = gsub("X", "", sequencing_id))
# shorten annotation
ko_table_targets_l$Annotation_s <- str_extract(ko_table_targets_l$Annotation, "^[^;]*")
metadata_ko <- metadata[, c("sequencing_id", "extract_ID", "flux.CH4", "top_emitters", "variable_emitters", "rank", "species")]
data_ko <- merge(ko_table_targets_l, metadata_ko)
# filter ko table for what is in the target list
pathway_targets <- targets[targets$source == "pathway", ]$target
# filter ko_table by Annotation = ko_targets
pathway_table_targets <- pathway[pathway$pathway %in% pathway_targets, ]
# remove first column
pathway_table_targets <- pathway_table_targets[, -1]
# ko_table_targets to long format
pathway_table_targets_l <- pathway_table_targets %>%
pivot_longer(cols = -pathway, names_to = "sequencing_id", values_to = "reads")
metadata_pathway <- metadata[, c("sequencing_id", "extract_ID", "flux.CH4", "top_emitters", "variable_emitters", "rank", "species")]
data_pathway <- merge(pathway_table_targets_l, metadata_pathway)
# reads ~ flux.CH4 (ko table)
ggplot(data_ko, aes(x = reads, y = flux.CH4)) +
geom_point() +
geom_smooth(method = "lm") +
facet_wrap(species~Annotation_s, scales = "free", ncol = 6) +
labs(title = "reads ~ flux.CH4", x = "reads", y = "flux.CH4")+
theme_classic()
# reads ~ flux.CH4 (pathways)
ggplot(data_pathway, aes(x = reads, y = flux.CH4)) +
geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~species) +
labs(title = "reads ~ flux.CH4", x = "reads", y = "flux.CH4")+
theme_classic()
# omit rows = NA for column rank
data_pathway_q1 <- data_pathway[!is.na(data_pathway$rank), ]
data_ko_q1 <- data_ko[!is.na(data_ko$rank), ]
ggplot(data_pathway_q1, aes(x = species, y = reads, fill = rank)) +
geom_boxplot() +
theme_classic()
ggplot(data_ko_q1, aes(x = species, y = reads, fill = rank)) +
geom_boxplot() +
facet_wrap(~Annotation_s, scales = "free") +
theme_classic()
outputs <- read.csv("data/tony_output_original.csv")
outputs <- read.csv("/Users/abbeyyatsko/Desktop/repos/savanna/data/tony_output_original.csv")
View(outputs)
# weight by area
outputs$weighted_test_area <- outputs$test_area / 900
# heights to shade volume, weighted by test area
outputs <- outputs %>%
mutate(ground_truth_mean_sv = (ground_truth_mean*weighted_test_area),
prediction_mean_sv = (prediction_mean*weighted_test_area))
outputs <- outputs %>%
mutate(residuals = ground_truth_mean_sv - prediction_mean_sv)
0.7522312*0.899504825
0.68120765*0.899504825
0.6127496- 0.6766356

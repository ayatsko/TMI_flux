avgflux <- unique(avgflux)
# average methane flux by species
ggplot(data = avgflux, aes(x = as.factor(ID_cleaned), y = x)) +
geom_boxplot()+
ylab("CH4 flux umol/d/m2")+
theme_light()
# anova on mound averages between species
aov.3 <- aov(x ~ ID_cleaned, data = avgflux)
summary(aov.3)
TukeyHSD(aov.3)
# pick out top 4 highest methane fluxes by species
# (there is overlap between high and low of amitermes therefore shift from 5 to 4)
top <- avgflux %>%
arrange(desc(x)) %>%
group_by(ID_cleaned) %>%
slice(1:4)
top$rank <- "top"
top
# pick out bottom 4 lowest methane fluxes by species
bottom <- avgflux %>%
arrange(x) %>%
group_by(ID_cleaned) %>%
slice(1:4)
bottom$rank <- "bottom"
bottom
# remove entries without species info, clean up df
q1 <- rbind(top, bottom)
q1 <- q1 %>%
rename(sample = Group.1,
avg_flux = x)
# now take these IDs and show boxplots to see distribution of fluxes (not just average)
# join df
q1_all <- left_join(q1, mounds, by = "sample")
# plot for all
ggplot(data = q1_all, aes(x = sample, y = flux.CH4, color =  as.factor(rank), fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
theme_light()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="YlOrRd")
# bar graph grouped by species - colored by top and bottom
ggplot(q1, aes(x = reorder(as.factor(sample), -avg_flux), y = avg_flux, fill = rank)) +
geom_bar(stat='identity') +
facet_grid(~ as.factor(ID_cleaned),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# plot for high values
q1H <- q1_all[q1_all$rank == c('top'),]
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
theme_light()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="YlOrRd")+
ggtitle("mounds w highest average flux")
# plot for low values
q1L <- q1_all[q1_all$rank == c('bottom'),]
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
theme_light()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="YlOrRd")+
ggtitle("mounds w lowest average flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
# export .csv with q1 mounds
# write.csv(q1, "/Users/abbeyyatsko/Downloads/q1.csv")
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
theme_light()+
theme( legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
# plot for low values
q1L <- q1_all[q1_all$rank == c('bottom'),]
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
theme_light()+
#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+\
theme(legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with lowest average CH4 flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
View(q1H)
View(q1_all)
q1_all$species <- ifelse(q1_all$ID_cleaned.x == "Ami", "A. laurensis", "")
q1_all$species <- ifelse(q1_all$ID_cleaned.x == "Nasuti", "N. magnus",q1_all$species )
q1_all$species <- ifelse(q1_all$ID_cleaned.x == "Copto", "C. acinaciformis", q1_all$species)
# plot for high values
q1H <- q1_all[q1_all$rank == c('top'),]
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
# plot for low values
q1L <- q1_all[q1_all$rank == c('bottom'),]
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = ID_cleaned.x)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+\
theme(legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with lowest average CH4 flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
# plot for low values
q1L <- q1_all[q1_all$rank == c('bottom'),]
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+\
theme(legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with lowest average CH4 flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+\
theme(legend.position = "none")+
facet_grid(~ as.factor(ID_cleaned.x),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with lowest average CH4 flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
facet_wrap(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
q1Hplot <- ggplot(data = q1H, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
facet_grid(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with highest average CH4 flux")
q1Lplot <- ggplot(data = q1L, aes(x = sample, y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")+\
theme(legend.position = "none")+
facet_grid(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
scale_fill_brewer(palette="Blues")+
ggtitle("Mounds with lowest average CH4 flux")
# overall sampling for Q1
ggarrange(q1Hplot, q1Lplot, ncol = 1)
# calculate min and max flux for each sample
data_min <- mounds %>%
group_by(sample) %>%
summarise_at(vars(flux.CH4),
list(min = min))
data_max <- mounds %>%
group_by(sample) %>%
summarise_at(vars(flux.CH4),
list(max = max))
minmax <- merge(data_max, data_min, by="sample")
minmax$range <- minmax$max - minmax$min
# merge in species info
minmax <- left_join(minmax, y, by = "sample")
minmax <- unique(minmax)
# range in intermound methane production by sample
ggplot(data = minmax, aes(x = as.factor(ID_cleaned), y = range)) +
geom_boxplot()+
ylab("CH4 flux umol/d/m2")+
theme_light()
# choose 5 most variable mounds (greatest range)
q2 <- minmax %>%
arrange(desc(range)) %>%
group_by(ID_cleaned) %>%
slice(1:5)
# boxplot of individual mounds
q2_samps <- as.vector(q2$sample)
q2_samps <- mounds[ mounds$sample %in% q2_samps, ]
unique(q2_samps$sample)
ggplot(data = q2_samps, aes(x = as.factor(sample), y = flux.CH4, fill = ID_cleaned)) +
geom_boxplot()+
geom_jitter()+
facet_grid(~ as.factor(ID_cleaned),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")
# see the overlap of samples in q1 and q2
matches <- inner_join(q1, q2,
c("sample" = "sample"))
# export .csv with q2 mounds
# write.csv(q2, "/Users/abbeyyatsko/Downloads/q2.csv")
View(q2_samps)
q2_samps$species <- ifelse(q2_samps$ID_cleaned == "Ami", "A. laurensis", "")
q2_samps$species <- ifelse(q2_samps$ID_cleaned == "Nasuti", "N. magnus",q2_samps$species )
q2_samps$species <- ifelse(q2_samps$ID_cleaned == "Copto", "C. acinaciformis", q2_samps$species)
ggplot(data = q2_samps, aes(x = as.factor(sample), y = flux.CH4, fill = ID_cleaned)) +
geom_boxplot()+
geom_jitter()+
facet_grid(~ as.factor(ID_cleaned),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")
ggplot(data = q2_samps, aes(x = as.factor(sample), y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
facet_grid(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")
ggplot(data = q2_samps, aes(x = as.factor(sample), y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
facet_grid(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")
ggplot(data = q2_samps, aes(x = as.factor(sample), y = flux.CH4, fill = species)) +
geom_boxplot()+
geom_jitter()+
facet_grid(~ as.factor(species),
scales = "free_x",
space = "free_x",
switch = "x")+
ylab("CH4 flux umol/d/m2")+
xlab("")+
theme_classic()+
theme( legend.position = "none")+
scale_fill_brewer(palette="Blues")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(ggpubr)
library(viridis)
library(tidyr)
library(broom)
library(purrr)
library(tidyverse)
library(rstatix)
CO2_fluxfinal <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/CO2_fluxfinal_all.csv")
CH4_fluxfinal<- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/CH4_fluxfinal_all.csv")
# merge in species data to flux data
species <- read.csv("/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/Abbey termites .xlsx - Sheet1.csv")
species <- species[c("X", "ID_cleaned")]
# merge sp and CH4flux_final, CO2_fluxfinal
colnames(species)[1] = "sample"
CH4_fluxfinal <- merge(CH4_fluxfinal, species, by = c("sample"))
CO2_fluxfinal <- merge(CO2_fluxfinal, species, by = c("sample"))
# new column for methane:co2
# first need to convert CO2 from mmol to umol (in order to match CH4 in units of umol)
# (conversion factor 1000umol = 1mmol)
CO2_fluxfinal$flux.CO2_umol <- CO2_fluxfinal$flux.CO2*1000
CO2_fluxfinal <- CO2_fluxfinal %>% relocate(flux.CO2_umol, .after = flux.CO2)
# take out just CO2 flux to paste in working CH4_fluxfinal df
a <- CO2_fluxfinal[c("Time_start", "flux.CO2_umol")]
CH4_fluxfinal <- merge(CH4_fluxfinal, a, by = c("Time_start"))
CH4_fluxfinal <- CH4_fluxfinal %>% relocate(flux.CO2_umol, .after = flux.CH4)
CH4_fluxfinal$ch4_co2 <-  CH4_fluxfinal$flux.CH4/CH4_fluxfinal$flux.CO2_umol
CH4_fluxfinal <- CH4_fluxfinal %>% relocate(ch4_co2, .after = flux.CH4)
# new column to add arboreal where 1 = arboreal, 0 = not arboreal
CO2_fluxfinal$arboreal[CO2_fluxfinal$chamber == "mini"] <- 1
CO2_fluxfinal$arboreal[!CO2_fluxfinal$chamber == "mini"] <- 0
CH4_fluxfinal$arboreal[CH4_fluxfinal$chamber == "mini"] <- 1
CH4_fluxfinal$arboreal[!CH4_fluxfinal$chamber == "mini"] <- 0
# subset df to create just methane from soils and just mounds (for later on. just to have df prepped)
soils <- CH4_fluxfinal[CH4_fluxfinal$flux_source == 's',]
mounds <- CH4_fluxfinal[CH4_fluxfinal$flux_source == 'm',]
# arboreal only
arboreal <- mounds[mounds$arboreal == 1,]
# omit arboreal from mound measurements
mounds <- mounds[mounds$arboreal == 0,]
# remove unidentified mounds
mounds[mounds==""] <- NA
mounds_ID <- mounds[!is.na(mounds$ID_cleaned),]
mounds_ID$ID_cleaned <- as.factor(mounds_ID$ID_cleaned)
# remove duplicate ID columns
# mounds_ID <- subset( mounds_ID, select = -c(ID_cleaned.x, ID_cleaned.y) )
# write.csv(mounds, "/Users/abbeyyatsko/Desktop/repos/TMI_flux/data/finalfluxes/mounds.csv")
# overall mound methane flux by species
# first find mound averages
mound_average <- mounds_ID %>% group_by(sample, campaign, ID_cleaned) %>%
summarise(mean_fluxCH4=mean(flux.CH4),mean_fluxCO2=mean(flux.CO2_umol), mean_fluxCH4CO2=mean(ch4_co2) )
ggplot(data = mound_average[!mound_average$ID_cleaned =="Macro",], aes(x = as.factor(ID_cleaned), y = mean_fluxCH4, fill = ID_cleaned)) +
geom_boxplot()+
stat_compare_means(method = "anova")+
scale_fill_brewer("Blues")+
ylab("CH4 flux (umol/d/m2)")+
xlab("")+
scale_x_discrete(labels= c("A. laurensis", "C. acinaciformis", "N.magnus"))+
theme_classic()+
theme(legend.position="none")
# merge in real time data from GPS records of mound being tagged (this is an overall mound estimate for the may campaign mounds)
maymounds <- mounds[mounds$campaign == "may22",]
maymounds_rm <- maymounds[maymounds$sample %in% target_mounds,]
ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'lm', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE, color = ID_cleaned)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE, fill = ID_cleaned)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4, color = ID_cleaned)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE, fill = ID_cleaned)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4, color = ID_cleaned)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
ggplot(data = mounds_ID, aes(x = avg_respT, y = flux.CH4, color = ID_cleaned)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
ggplot(data = mounds_ID[!mounds_ID$ID_cleaned == "Macro",], aes(x = avg_respT, y = flux.CH4, color = ID_cleaned)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
#facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
# scatter plot - methane
h1 <- ggplot(data = mounds_ID[!mounds_ID$ID_cleaned == "Macro",], aes(x = avg_respT, y = flux.CH4, color = ID_cleaned)) +
geom_point(aes(color = ID_cleaned))+
geom_smooth(method = 'loess', se = FALSE)+
ylab("CH4 flux umol/d/m2")+
xlab("Average Mound Surface Temperature (C)")+
scale_color_brewer("Blues") +
facet_wrap(~campaign)+ # take this out to look at overall temperature effect
guides(color=guide_legend(title="Campaign"))+
theme_linedraw()
h1
